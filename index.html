import React, { useState, useMemo } from 'react';
import { Search, Calendar, Clock, User, MapPin, BookOpen, ChevronRight, GraduationCap, Filter } from 'lucide-react';

// Datos extraídos y actualizados
const initialData = [
  { id: 1, carrera: "Pedagogía Inglés Valpo.", codigo: "SEL 3113-1", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Martes", bloque: "1 y 2", hora: "8:00-9:45", lab: "CC5", docente: "Melissa Vargas" },
  { id: 2, carrera: "Pedagogía Castellano San Felipe", codigo: "SEL 3113-2", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Miércoles", bloque: "2 y 3", hora: "9:50-12:15", lab: "San Felipe", docente: "Daniela Salinas" },
  { id: 3, carrera: "Pedagogía Inglés San Felipe", codigo: "SEL 3113-3", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 20, dia: "Miércoles", bloque: "5 y 6", hora: "14:00-16:45", lab: "San Felipe", docente: "Daniela Salinas" },
  { id: 4, carrera: "Pedagogía en Filosofía", codigo: "SEL 3113-4", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 35, dia: "Martes", bloque: "1 y 2", hora: "8:00-9:45", lab: "CC6", docente: "José Miranda" },
  { id: 5, carrera: "Nutrición y dietética", codigo: "SEL 3113-5", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Martes", bloque: "3 y 4", hora: "11:00-13:45", lab: "CC6", docente: "Antonio Marín" },
  { id: 6, carrera: "Nutrición y dietética", codigo: "SEL 3113-6", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 20, dia: "Martes", bloque: "3 y 4", hora: "11:00-13:45", lab: "CS 104", docente: "Francisca Valdés" },
  { id: 7, carrera: "Fonoaudiología", codigo: "SEL 3113-7", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Martes", bloque: "3 y 4", hora: "11:00-13:45", lab: "CS 102", docente: "José Miranda" },
  { id: 8, carrera: "Terapia Ocupacional", codigo: "SEL 3113-8", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Martes", bloque: "3 y 4", hora: "11:00-13:45", lab: "CC5", docente: "Diego Cabrera" },
  { id: 9, carrera: "Kinesiología", codigo: "SEL 3113-9", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Miércoles", bloque: "1 y 2", hora: "8:00-9:45", lab: "CC5", docente: "José Miranda" },
  { id: 10, carrera: "Kinesiología", codigo: "SEL 3113-10", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 25, dia: "Miércoles", bloque: "1 y 2", hora: "8:00-9:45", lab: "CC6", docente: "Macarena Rojas" },
  { id: 11, carrera: "Diseño", codigo: "TIC 1111-1", asignatura: "TIC para la Vida Académica", cupos: 25, dia: "Lunes", bloque: "1 y 2", hora: "8:00-9:45", lab: "Lab Artes B-401", docente: "Humberto Zapata" },
  { id: 12, carrera: "Diseño", codigo: "SEL 3114-1", asignatura: "EMPLEO DE TIC PARA LA VIDA PROFESIONAL", cupos: 25, dia: "Martes", bloque: "1 y 2", hora: "8:00-9:45", lab: "Lab Artes B-401", docente: "Humberto Zapata" },
  { id: 13, carrera: "Teatro", codigo: "TIC 1111-2", asignatura: "TIC PARA LA VIDA PROFESIONAL", cupos: 15, dia: "Jueves", bloque: "1 y 2", hora: "8:00-9:45", lab: "Lab Artes B-401", docente: "Macarena Rojas" },
  { id: 14, carrera: "Pedagogía Educación Musical", codigo: "SEL 3113-10", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 15, dia: "Miércoles", bloque: "1 y 2", hora: "8:00-9:45", lab: "CC6", docente: "Macarena Rojas" },
  { id: 15, carrera: "Ingeniería Comercial", codigo: "SEL 3113-12", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 20, dia: "Miércoles", bloque: "1 y 2", hora: "8:00-9:45", lab: "CS 102", docente: "Melissa Vargas" },
  { id: 16, carrera: "Ingeniería Civil Ambiental", codigo: "TIC 1111-5", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 0, dia: "Viernes", bloque: "1 y 2", hora: "8:00-9:45", lab: "CS 102", docente: "Melissa Vargas" },
  { id: 17, carrera: "Ingeniería Civil Informática", codigo: "TIC 1111-5", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 35, dia: "Viernes", bloque: "1 y 2", hora: "8:00-9:45", lab: "CS 102", docente: "Melissa Vargas" },
  { id: 18, carrera: "Ped. Biología y Cs", codigo: "SEL 3113-13", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 6, dia: "Miércoles", bloque: "3 y 4", hora: "11:00-13:45", lab: "CS 102", docente: "Marcela Vera" },
  { id: 19, carrera: "Derecho", codigo: "SEL 5114-1", asignatura: "EMPLEO DE TIC PARA LA VIDA PROFESIONAL", cupos: 40, dia: "Lunes", bloque: "1 y 2", hora: "8:00-9:45", lab: "C6", docente: "José Miranda" },
  { id: 20, carrera: "Psicología", codigo: "SEL 3113-20", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Lunes", bloque: "3 y 4", hora: "11:00-13:45", lab: "CC5", docente: "Melissa Vargas" },
  { id: 21, carrera: "Pedagogía Artes Visuales", codigo: "TIC 1111-3", asignatura: "TIC PARA LA VIDA ACADÉMICA", cupos: 20, dia: "Martes", bloque: "5 y 6", hora: "14:00-16:45", lab: "CC 6", docente: "Diego Cabrera" },
  { id: 22, carrera: "Dibujante Proyectista", codigo: "TIC 1111-4", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 15, dia: "Lunes", bloque: "1 y 2", hora: "8:00-9:45", lab: "CC 5", docente: "Antonio Marín" },
  { id: 23, carrera: "Licenciatura en Arte", codigo: "TIC 1111-4", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 30, dia: "Lunes", bloque: "1 y 2", hora: "8:00-9:45", lab: "CC 5", docente: "Antonio Marín" },
  { id: 24, carrera: "Ped. Educación Física Damas", codigo: "SB 3113-14", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Jueves", bloque: "3 y 4", hora: "11:00-13:45", lab: "CC5", docente: "Francisca Valdés" },
  { id: 25, carrera: "Ped. Educación Física Varones", codigo: "SB 3113-15", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Jueves", bloque: "3 y 4", hora: "11:00-13:45", lab: "CC6", docente: "Daniela Salinas" },
  { id: 26, carrera: "Ped. Educación Física Damas", codigo: "TIC 1111-7", asignatura: "TIC para la Vida Académica", cupos: 40, dia: "Jueves", bloque: "1 y 2", hora: "8:00-9:45", lab: "CC5", docente: "Marcela Vera" },
  { id: 27, carrera: "Ped. Educación Física Varones", codigo: "TIC 1111-8", asignatura: "TIC para la Vida Académica", cupos: 40, dia: "Jueves", bloque: "1 y 2", hora: "8:00-9:45", lab: "CC6", docente: "Daniela Salinas" },
  { id: 28, carrera: "Pedagogía Ed Diferencial Valpo.", codigo: "SEL 3113-17", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Jueves", bloque: "1 y 2", hora: "8:00-9:45", lab: "LAB ARTES 401", docente: "José Miranda" },
  { id: 29, carrera: "Pedagogía Ed Diferencial San Felipe", codigo: "SEL 3113-16", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 46, dia: "Martes", bloque: "2 y 3", hora: "9:50-12:15", lab: "San Felipe", docente: "Germán Flores" },
  { id: 30, carrera: "Pedagogía Educación Básica Valpo.", codigo: "SB 3113-18", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Jueves", bloque: "1 y 2", hora: "8:00-9:45", lab: "CS 104", docente: "Fabián González" },
  { id: 31, carrera: "Educación Parvularia Valpo.", codigo: "SB 3113-19", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Jueves", bloque: "1 y 2", hora: "8:00-9:45", lab: "CS 102", docente: "Francisca Valdés" },
  { id: 32, carrera: "Pedagogía Ed. Diferencial Valpo.", codigo: "SB 3113-25", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Viernes", bloque: "1 y 2", hora: "8:00-9:45", lab: "CC 5", docente: "Marcela Vera" },
  { id: 33, carrera: "Educación Parvularia Valpo.", codigo: "SB 3113-26", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Miércoles", bloque: "3 y 4", hora: "11:00-13:45", lab: "CC 5", docente: "Melissa Vargas" },
  { id: 34, carrera: "Psicología", codigo: "SB 3113-21", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Martes", bloque: "5 y 6", hora: "14:00-16:45", lab: "CC5", docente: "Melissa Vargas" },
  { id: 35, carrera: "Periodismo", codigo: "SB 3113-24", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 25, dia: "Lunes", bloque: "1 y 2", hora: "8:00-9:45", lab: "CS 102", docente: "Marcela Vera" },
  { id: 36, carrera: "Psicología", codigo: "SB 3113-22", asignatura: "EMPLEO DE TIC PARA LA VIDA ACADÉMICA", cupos: 40, dia: "Lunes", bloque: "3 y 4", hora: "14:00-16:45", lab: "CS 102", docente: "Macarena Rojas" },
  { id: 37, carrera: "Sociología", codigo: "TIC 1111-9", asignatura: "TIC para la Vida Académica", cupos: 0, dia: "Martes", bloque: "1 y 2", hora: "8:00-9:45", lab: "CS 104", docente: "Macarena Rojas" },
];

export default function HorarioApp() {
  const [activeCategory, setActiveCategory] = useState('docente'); // docente, carrera, seccion, horario, laboratorio
  const [selectedOption, setSelectedOption] = useState('');

  // Definición de categorías para la interfaz
  const categories = [
    { id: 'docente', label: 'Docente', field: 'docente' },
    { id: 'carrera', label: 'Carrera', field: 'carrera' },
    { id: 'seccion', label: 'Sección', field: 'codigo' },
    { id: 'horario', label: 'Día', field: 'dia' }, // Simplificado a Día para el dropdown
    { id: 'laboratorio', label: 'Laboratorio', field: 'lab' },
  ];

  // Obtener las opciones únicas para la categoría activa
  const currentOptions = useMemo(() => {
    const categoryConfig = categories.find(c => c.id === activeCategory);
    if (!categoryConfig) return [];

    const field = categoryConfig.field;
    const options = [...new Set(initialData.map(item => item[field]))];
    
    // Ordenar alfabéticamente
    if (activeCategory === 'horario') {
      const dayOrder = { "Lunes": 1, "Martes": 2, "Miércoles": 3, "Jueves": 4, "Viernes": 5, "Sábado": 6 };
      return options.sort((a, b) => (dayOrder[a] || 99) - (dayOrder[b] || 99));
    }
    
    return options.sort();
  }, [activeCategory]);

  // Función de filtrado dinámica basada en la selección
  const filteredData = useMemo(() => {
    // Si no se ha seleccionado nada en el dropdown, no mostrar nada
    if (!selectedOption) return [];

    return initialData.filter(item => {
      const categoryConfig = categories.find(c => c.id === activeCategory);
      const field = categoryConfig?.field;
      
      if (!field) return true;
      
      // Comparación exacta para el dropdown
      return item[field] === selectedOption;
    });
  }, [activeCategory, selectedOption]);

  const handleCategoryChange = (catId) => {
    setActiveCategory(catId);
    setSelectedOption(''); // Reiniciar selección al cambiar de categoría
  };

  return (
    <div className="min-h-screen bg-slate-50 font-sans">
      
      {/* Header Institucional UPLA */}
      <div className="bg-white border-b border-slate-200 py-6">
        <div className="container mx-auto px-4 text-center">
          {/* Logo UPLA Oficial */}
          <div className="flex items-center justify-center mb-6">
            <img 
              src="https://www.upla.cl/portada/wp-content/uploads/2015/09/logoupla.png" 
              alt="Universidad de Playa Ancha" 
              className="h-20 object-contain"
            />
          </div>
          
          <h1 className="text-2xl md:text-3xl font-bold text-slate-900 max-w-4xl mx-auto leading-tight">
            Horarios y secciones Empleo de TIC Vida Académica 1º Semestre 2026
          </h1>
          <p className="text-slate-500 mt-2 text-sm md:text-base">
            Selecciona una categoría y elige una opción para ver los horarios.
          </p>
        </div>
      </div>

      <main className="container mx-auto px-4 py-8">
        
        {/* Panel de Búsqueda Estilo UPLA */}
        <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8 max-w-5xl mx-auto">
          
          <p className="text-sm font-semibold text-slate-700 mb-3">1. Selecciona qué quieres buscar:</p>
          
          {/* Botones de Categoría */}
          <div className="flex flex-wrap gap-2 mb-6">
            {categories.map((cat) => (
              <button
                key={cat.id}
                onClick={() => handleCategoryChange(cat.id)}
                className={`px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 flex items-center gap-2 ${
                  activeCategory === cat.id
                    ? 'bg-sky-500 text-white shadow-md transform scale-105'
                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                }`}
              >
                {cat.label}
              </button>
            ))}
          </div>

          <p className="text-sm font-semibold text-slate-700 mb-3">2. Elige una opción de la lista:</p>

          {/* Selector Desplegable (Dropdown) */}
          <div className="relative">
            <Filter className="absolute left-4 top-3.5 h-5 w-5 text-slate-500" />
            <select
              className="w-full pl-12 pr-10 py-3 bg-slate-50 border border-slate-300 rounded-lg text-slate-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all shadow-sm appearance-none cursor-pointer"
              value={selectedOption}
              onChange={(e) => setSelectedOption(e.target.value)}
            >
              <option value="">-- Ver todos los {categories.find(c => c.id === activeCategory)?.label.toLowerCase()}s --</option>
              {currentOptions.map((option, index) => (
                <option key={index} value={option}>
                  {option}
                </option>
              ))}
            </select>
            {/* Flecha custom para el select */}
            <div className="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-slate-500">
              <ChevronRight className="h-4 w-4 rotate-90" />
            </div>
          </div>
          
          {selectedOption && (
            <div className="mt-2 text-xs text-slate-400 text-right">
              Mostrando {filteredData.length} resultados
            </div>
          )}
        </div>

        {/* Lógica de Visualización: Mostrar instrucciones si no hay selección */}
        {!selectedOption ? (
            <div className="text-center py-20 bg-white rounded-xl border border-slate-200 shadow-sm opacity-80 max-w-3xl mx-auto">
                <div className="bg-sky-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <Search className="h-10 w-10 text-sky-400" />
                </div>
                <h3 className="text-xl font-bold text-slate-700 mb-2">Comienza tu búsqueda</h3>
                <p className="text-slate-500 max-w-md mx-auto">
                    Selecciona una categoría (Docente, Carrera, etc.) y una opción de la lista de arriba para visualizar los horarios correspondientes.
                </p>
            </div>
        ) : (
            <>
                {/* Tabla de Resultados (Escritorio) */}
                <div className="hidden md:block overflow-hidden rounded-xl shadow-sm border border-slate-200 bg-white">
                <table className="w-full text-left border-collapse">
                    <thead>
                    <tr className="bg-slate-50 text-slate-600 text-xs uppercase tracking-wider border-b border-slate-200">
                        <th className="p-4 font-bold">Código / Sección</th>
                        <th className="p-4 font-bold">Carrera</th>
                        <th className="p-4 font-bold">Asignatura</th>
                        <th className="p-4 font-bold">Horario</th>
                        <th className="p-4 font-bold">Laboratorio</th>
                        <th className="p-4 font-bold">Docente</th>
                    </tr>
                    </thead>
                    <tbody className="text-sm divide-y divide-slate-100">
                    {filteredData.length > 0 ? (
                        filteredData.map((item) => (
                        <tr key={item.id} className="hover:bg-sky-50 transition-colors group">
                            <td className="p-4 font-mono text-xs font-semibold text-slate-500 group-hover:text-sky-700">
                            {item.codigo}
                            </td>
                            <td className="p-4 font-medium text-slate-800">
                            {item.carrera}
                            </td>
                            <td className="p-4 text-slate-600 text-xs">
                            {item.asignatura}
                            </td>
                            <td className="p-4">
                            <div className="flex flex-col">
                                <span className="font-bold text-slate-700 capitalize">{item.dia}</span>
                                <span className="text-xs text-slate-500">{item.hora}</span>
                            </div>
                            </td>
                            <td className="p-4">
                            <span className="inline-flex items-center gap-1 bg-amber-50 text-amber-700 px-2 py-1 rounded text-xs font-bold border border-amber-100">
                                {item.lab}
                            </span>
                            </td>
                            <td className="p-4 text-slate-600">
                            {item.docente}
                            </td>
                        </tr>
                        ))
                    ) : (
                        <tr>
                        <td colSpan="6" className="p-12 text-center">
                            <div className="flex flex-col items-center justify-center text-slate-400">
                            <Search className="h-10 w-10 mb-2 opacity-20" />
                            <p>No se encontraron resultados para tu búsqueda.</p>
                            </div>
                        </td>
                        </tr>
                    )}
                    </tbody>
                </table>
                </div>

                {/* Vista Móvil (Tarjetas) */}
                <div className="md:hidden grid grid-cols-1 gap-4">
                {filteredData.length > 0 ? (
                    filteredData.map((item) => (
                    <div key={item.id} className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-1 h-full bg-sky-500"></div>
                        <div className="pl-3">
                        <div className="flex justify-between items-start mb-2">
                            <span className="text-xs font-bold text-sky-600 uppercase tracking-wide">{item.carrera}</span>
                            <span className="text-xs font-mono text-slate-400 bg-slate-50 px-2 py-0.5 rounded">{item.codigo}</span>
                        </div>
                        
                        <h3 className="font-bold text-slate-800 mb-3 text-sm">{item.asignatura}</h3>
                        
                        <div className="space-y-2">
                            <div className="flex items-center text-sm text-slate-600">
                            <User size={16} className="text-slate-400 mr-2" />
                            {item.docente}
                            </div>
                            <div className="flex items-center text-sm text-slate-600">
                            <Calendar size={16} className="text-slate-400 mr-2" />
                            <span className="capitalize mr-2">{item.dia}</span>
                            <span className="text-slate-400">|</span>
                            <span className="ml-2">{item.hora}</span>
                            </div>
                            <div className="flex items-center text-sm text-slate-600">
                            <MapPin size={16} className="text-slate-400 mr-2" />
                            {item.lab}
                            </div>
                        </div>
                        </div>
                    </div>
                    ))
                ) : (
                    <div className="p-8 text-center text-slate-500">
                    No se encontraron resultados.
                    </div>
                )}
                </div>
            </>
        )}

      </main>
    </div>
  );
}